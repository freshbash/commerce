{% extends "auctions/layout.html" %}
{% load static %}

{% block title %}
    {{ listing }}
{% endblock %}

{% block body %}
    <div class="active-listings">
        <h2>{{ details.title }}</h2>
        <div class="image-div-view">
            {% if details.image_url %}
                <img class="item-image-view" src="{{ details.image_url }}">
            {% else %}
                <img class="item-image-view" src="{% static 'auctions/no-image.png' %}">
            {% endif %}
        </div>
        <div style="margin: 25px 0px;">
            {% if not flag %}
                <form action="/watchlist/" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="listing-id" value="{{ details.id }}">
                    <input id="button" type="submit" value="Add to Watchlist">
                </form>
            {% else %}
                <form action="/watchlist" method="get">
                    <input id="button" type="submit" value="Go to Watchlist">
                </form>
            {% endif %}
        </div>
        <div style="margin: 0px 0px 25px 0px;">
            <label style="font-weight: bold;">Description:</label>
            <div style="border: 1px solid lightgrey; border-radius: 5px; padding: 5px;">
                {{ details.description }}
            </div>
        </div>
        <div style="margin: 0px 0px 25px 0px;">
            <label style="font-weight: bold;">Starting Bid:</label>
            <div style="border: 1px solid lightgrey; border-radius: 5px; padding: 5px;">
                &#36;&nbsp;{{ details.starting_bid }}
            </div>
        </div>
        <div style="margin: 0px 0px 25px 0px;">
            <label style="font-weight: bold;">Current Price:</label>
            <div style="border: 1px solid lightgrey; border-radius: 5px; padding: 5px;">
                &#36;&nbsp;{{ details.current_price }}
            </div>
        </div>
        <div style="margin: 0px 0px 25px 0px;">
            {% if user.id == details.user.id %}
                {% if details.status == 'A' %}
                    <a href="{% url 'close' details.id %}">Close bidding</a>
                {% else %}
                    <p>{{ details.highest_bidder.username }} has won this auction</p>
                {% endif %}
            {% else %}
                <label style="font-weight: bold;">Place your bid:</label>
                {% if details.status == 'A' %}
                    <form action="{% url 'bid' details.id %}" method="post">
                        {% csrf_token %}
                        <input class="input-style" type="number" step="0.01" min="{{ details.current_price }}" name="bid">
                        <input class="btn-style" type="submit" value="Place Bid">
                    </form>
                {% else %}
                    {% if details.highest_bidder.id == user.id %}
                        <p>You have won this auction</p>
                    {% else %}
                        <p>{{ details.highest_bidder.username }} has won this auction</p>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
        <div style="border-bottom: 5px solid black; margin: 20px 0px;"></div>
        <h4 style="font-weight: bold;">Details</h4>
        <ul>
            <li><label style="font-weight: bold;">Posted by:&nbsp;</label>{{ details.user.username }}</li>
            <li>{% if details.category %}
                    <label style="font-weight: bold;">Category:&nbsp;</label>{{ details.category }}
                {% else %}                    
                    <label style="font-weight: bold;">No category mentioned</label>
                {% endif %}
            </li>
        </ul>
        <div style="border-bottom: 5px solid black; margin: 20px 0px;"></div>
        <div style="margin: 0px 0px 25px 0px;">
            <form action="{% url 'addcomment' details.id %}" method="post">
                {% csrf_token %}
                <input class="input-style" type="text" name="comment" placeholder="Type your comment">
                <input class="btn-style" type="submit" value="Add comment">
            </form>
        </div>
        <div>
            {% for comment in comments %}
                <div class="comment">
                    {% if comment.user.id == details.user.id %}
                        <label style="font-weight: bold;">{{ comment.user.username }}(Original Poster):</label>
                    {% else %}
                        <label style="font-weight: bold;">{{ comment.user.username }}:</label>
                    {% endif %}
                    <p>{{ comment.comment }}</p>
                </div>
            {% empty %}
                <label>No comments</label>
            {% endfor %}
        </div>
    </div>
{% endblock %}
